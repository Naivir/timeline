# Verification Evidence: 003-add-timeline-memories

## Command Results

### Backend US2 contract/integration tests

Command:

```bash
cd /Users/brianandres/Documents/Timeline/backend
UV_CACHE_DIR=../.uv-cache uv run pytest tests/contract/test_memories_patch_contract.py tests/integration/test_memory_edit_temporal_anchor.py
```

Result: `3 passed`

### Frontend US2 unit/integration tests

Command:

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test -- tests/memories/memory-drag-edit.test.ts tests/timeline-page.test.tsx
```

Result: `2 files passed, 8 tests passed`

### Frontend browser validation (edit interaction)

Command:

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test:e2e -- tests/memories/edit-memory.spec.ts
```

Result: `1 passed`

### Frontend screenshot sanity validation

Command:

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test:e2e -- tests/memories/ui-sanity-screens.spec.ts
```

Result: `1 passed`, screenshots captured.

## Screenshot Artifacts

Generated by Playwright in `frontend/test-results/`:

- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/01-base-screen.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/02-placement-mode.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/03-create-edit-popup.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/04-memory-inspect-popup.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/05-memory-edit-popup.png`

## Manual Visual Sanity Review (Agent-Reviewed)

Reviewer: Codex agent  
Date: 2026-02-22

Checklist and findings:

- Header/timeline overlap: PASS (header does not overlap timeline surface).
- Placement mode clarity: PASS (primary CTA clearly switches to placement prompt).
- Create flow popup: PASS (edit dialog opens immediately after placement with focused title input).
- Memory click-to-open details: PASS (details panel opens from icon click and displays saved fields).
- Edit flow accessibility/readability: PASS (controls and text remain legible; actions are reachable).
- Timeline remains visible while panel open: PASS (timeline remains visible and usable).

If any future screenshot fails this checklist, implementation must pause, add/adjust tests for the observed regression, apply fix, and rerun this review loop.

## Notes

- Screenshot sanity test includes a layout guard to ensure `Timeline Navigator` header does not overlap the timeline interaction surface.
- Edit interaction test asserts icon click opens details without triggering PATCH until Save is clicked.

## Iteration 2 (Post-Review Fixes)

Defects identified from screenshot review:
- Memory connector line could overshoot past timeline axis.
- Below-axis memory connector could render in the wrong direction.

Actions taken:
- Added connector geometry logic in `frontend/src/components/memories/memory-marker.tsx` to compute exact connector distance from marker edge to axis.
- Added unit assertions in `frontend/tests/memories/memory-positioning.test.ts` for above-axis and below-axis connector direction/length.
- Adjusted connector CSS anchor to center correctly in `frontend/src/index.css`.

Backend defect identified from runtime error:
- Existing SQLite DB schema missing `memory.vertical_ratio` caused create failure on user environment.

Actions taken:
- Added startup schema migration guard in `backend/src/db.py` to add `vertical_ratio` when missing.
- Added regression test `backend/tests/integration/test_db_schema_migration.py`.

Re-run results:
- Backend targeted tests: pass.
- Frontend targeted tests: pass.
- Screenshot sanity test: pass, including `03-memory-placed.png` with corrected connector behavior.

## Final Implementation Validation (2026-02-22)

Commands run:

```bash
cd /Users/brianandres/Documents/Timeline/backend
UV_CACHE_DIR=.uv-cache uv run pytest
```

Result: `15 passed`

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test -- tests/timeline-page.test.tsx tests/memories/*.test.ts tests/timeline/zoom-sensitivity.test.ts
```

Result: `5 files passed, 13 tests passed`

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test:e2e -- tests/memories/*.spec.ts
```

Result: `5 passed`

```bash
cd /Users/brianandres/Documents/Timeline/frontend
npm run test:e2e -- tests/memories/timeline-gesture-independence.spec.ts
```

Result: `1 passed`

Updated screenshot artifacts:

- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/01-base-screen.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/02-placement-mode.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/03-memory-placed.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/04-create-edit-popup.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/05-memory-inspect-popup.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/06-memory-edit-popup.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/07-delete-toast.png`
- `frontend/test-results/memories-ui-sanity-screens-23d35--timeline-and-memory-popups/08-undo-restored.png`

Manual screenshot review findings:

- Centered large modal: PASS.
- Tags label and footer placement with timestamp: PASS.
- Human-friendly timestamp rendering: PASS.
- Delete action visibility: PASS.
- Undo toast visibility and restore behavior: PASS.
